@model Security_Practice.Models.RegisterViewModel
@{
    ViewData["Title"] = "註冊";
}

<div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
        <div class="card shadow-lg border-0">
            <div class="card-header bg-success text-white text-center">
                <h3 class="mb-0">
                    <i class="fas fa-user-plus me-2"></i>用戶註冊
                </h3>
            </div>
            <div class="card-body p-4">
                <form asp-action="Register" method="post" class="needs-validation" novalidate>
                    <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label asp-for="Username" class="form-label">
                                <i class="fas fa-user me-1"></i> 使用者名稱 *
                            </label>
                            <input asp-for="Username" class="form-control" 
                                   placeholder="3-50個字符" autocomplete="username" required />
                            <div class="valid-feedback">
                                <i class="fas fa-check text-success"></i> 使用者名稱可用
                            </div>
                            <div class="invalid-feedback" id="username-feedback">
                                請輸入有效的使用者名稱
                            </div>
                            <span asp-validation-for="Username" class="text-danger small"></span>
                            <small class="form-text text-muted">只能包含字母、數字和 @@ # $ 符號</small>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label asp-for="Email" class="form-label">
                                <i class="fas fa-envelope me-1"></i> 電子郵件 *
                            </label>
                            <input asp-for="Email" type="email" class="form-control" 
                                   placeholder="your@email.com" autocomplete="email" required />
                            <div class="valid-feedback">
                                <i class="fas fa-check text-success"></i> 電子郵件可用
                            </div>
                            <div class="invalid-feedback" id="email-feedback">
                                請輸入有效的電子郵件地址
                            </div>
                            <span asp-validation-for="Email" class="text-danger small"></span>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label asp-for="Password" class="form-label">
                                <i class="fas fa-lock me-1"></i> 密碼 *
                            </label>
                            <div class="input-group">
                                <input asp-for="Password" type="password" class="form-control" 
                                       placeholder="至少8個字符" autocomplete="new-password" required />
                                <button class="btn btn-outline-secondary" type="button" id="togglePassword1">
                                    <i class="fas fa-eye" id="toggleIcon1"></i>
                                </button>
                            </div>
                            <span asp-validation-for="Password" class="text-danger small"></span>
                            <small class="form-text text-muted">只能包含字母、數字和 @@ # $ 符號</small>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label asp-for="ConfirmPassword" class="form-label">
                                <i class="fas fa-lock me-1"></i> 確認密碼 *
                            </label>
                            <div class="input-group">
                                <input asp-for="ConfirmPassword" type="password" class="form-control" 
                                       placeholder="再次輸入密碼" autocomplete="new-password" required />
                                <button class="btn btn-outline-secondary" type="button" id="togglePassword2">
                                    <i class="fas fa-eye" id="toggleIcon2"></i>
                                </button>
                            </div>
                            <span asp-validation-for="ConfirmPassword" class="text-danger small"></span>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label asp-for="PhoneNumber" class="form-label">
                            <i class="fas fa-phone me-1"></i> 手機號碼 (選填)
                        </label>
                        <input asp-for="PhoneNumber" type="tel" class="form-control" 
                               placeholder="09xxxxxxxx" autocomplete="tel" />
                        <span asp-validation-for="PhoneNumber" class="text-danger small"></span>
                        <small class="form-text text-muted">可包含數字和 @@ # $ - 符號</small>
                    </div>
                    
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="agreeTerms" required />
                            <label class="form-check-label" for="agreeTerms">
                                我同意 <a href="#" data-bs-toggle="modal" data-bs-target="#termsModal">使用條款</a> 
                                和 <a href="#" data-bs-toggle="modal" data-bs-target="#privacyModal">隱私權政策</a> *
                            </label>
                        </div>
                    </div>
                    
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-success btn-lg">
                            <i class="fas fa-user-plus me-2"></i>註冊帳戶
                        </button>
                    </div>
                    
                    <hr class="my-4">
                    
                    <div class="text-center">
                        <p class="mb-0">已經有帳戶了？</p>
                        <a asp-action="Login" class="btn btn-outline-primary">
                            <i class="fas fa-sign-in-alt me-2"></i>立即登入
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- 使用條款 Modal -->
<div class="modal fade" id="termsModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">使用條款</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>這是使用條款的內容...</p>
                <p>1. 用戶需要提供真實資訊進行註冊</p>
                <p>2. 禁止使用系統進行任何非法活動</p>
                <p>3. 用戶需要保護自己的帳戶安全</p>
            </div>
        </div>
    </div>
</div>

<!-- 隱私權政策 Modal -->
<div class="modal fade" id="privacyModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">隱私權政策</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>我們重視您的隱私權...</p>
                <p>1. 我們會保護您的個人資訊</p>
                <p>2. 不會將您的資訊提供給第三方</p>
                <p>3. 使用最高等級的加密技術保護資料</p>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // 密碼顯示/隱藏功能
        function setupPasswordToggle(toggleId, passwordId, iconId) {
            document.getElementById(toggleId).addEventListener('click', function() {
                const passwordField = document.getElementById(passwordId);
                const toggleIcon = document.getElementById(iconId);
                
                if (passwordField.type === 'password') {
                    passwordField.type = 'text';
                    toggleIcon.classList.remove('fa-eye');
                    toggleIcon.classList.add('fa-eye-slash');
                } else {
                    passwordField.type = 'password';
                    toggleIcon.classList.remove('fa-eye-slash');
                    toggleIcon.classList.add('fa-eye');
                }
            });
        }
        
        setupPasswordToggle('togglePassword1', 'Password', 'toggleIcon1');
        setupPasswordToggle('togglePassword2', 'ConfirmPassword', 'toggleIcon2');

        // 即時驗證使用者名稱
        $('#Username').on('blur', function() {
            const username = $(this).val();
            if (username.length >= 3) {
                $.get('@Url.Action("CheckUsername", "Account")', { username: username }, function(data) {
                    const usernameField = $('#Username');
                    const feedback = $('#username-feedback');
                    
                    if (data.available) {
                        usernameField.removeClass('is-invalid').addClass('is-valid');
                        feedback.text(data.message).removeClass('invalid-feedback').addClass('valid-feedback');
                    } else {
                        usernameField.removeClass('is-valid').addClass('is-invalid');
                        feedback.text(data.message).removeClass('valid-feedback').addClass('invalid-feedback');
                    }
                });
            }
        });

        // 即時驗證電子郵件
        $('#Email').on('blur', function() {
            const email = $(this).val();
            if (email.length > 0 && email.includes('@@')) {
                $.get('@Url.Action("CheckEmail", "Account")', { email: email }, function(data) {
                    const emailField = $('#Email');
                    const feedback = $('#email-feedback');
                    
                    if (data.available) {
                        emailField.removeClass('is-invalid').addClass('is-valid');
                        feedback.text(data.message).removeClass('invalid-feedback').addClass('valid-feedback');
                    } else {
                        emailField.removeClass('is-valid').addClass('is-invalid');
                        feedback.text(data.message).removeClass('valid-feedback').addClass('invalid-feedback');
                    }
                });
            }
        });

        // 表單驗證
        (function() {
            'use strict';
            window.addEventListener('load', function() {
                var forms = document.getElementsByClassName('needs-validation');
                var validation = Array.prototype.filter.call(forms, function(form) {
                    form.addEventListener('submit', function(event) {
                        if (form.checkValidity() === false) {
                            event.preventDefault();
                            event.stopPropagation();
                        }
                        form.classList.add('was-validated');
                    }, false);
                });
            }, false);
        })();
    </script>
}
